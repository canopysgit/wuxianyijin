下面是“参考基数选择规则”整理稿（仅聚焦参考基数选择，不含其他注意事项）。口径以你确认的规则为准：新引擎、宽口径（gross），社保年度按7月切换，工伤不影响此处结论。

定义

“首月工资”: 工资表中该员工最早一条月份记录的 gross_salary。
“YYYY年均”: 该员工在工资表中“YYYY年1-12月”所有有记录月份的 gross_salary 平均值（有几个月算几个月）。
2023H1（2023-01~06，社保年度=2022）

2021-11 入职: 用 2022年均
2022-01 入职: 用 首月工资
2022-07 入职: 用 首月工资
2023-01 入职: 用 首月工资
2023-07 入职: 本期不存在
2024-01 入职: 本期不存在
2024-07 入职: 本期不存在
2023H2（2023-07~09，社保年度=2023）

2021-11 入职: 用 2022年均
2022-01 入职: 用 2022年均
2022-07 入职: 用 2022年均
2023-01 入职: 用 首月工资
2023-07 入职: 用 首月工资
2024-01 入职: 本期不存在
2024-07 入职: 本期不存在
2024H1（2024-01~06，社保年度=2023）

2021-11 入职: 用 2022年均
2022-01 入职: 用 2022年均
2022-07 入职: 用 2022年均
2023-01 入职: 用 首月工资
2023-07 入职: 用 首月工资
2024-01 入职: 用 首月工资
2024-07 入职: 本期不存在
2024H2（2024-07~09，社保年度=2024）

2021-11 入职: 用 2023年均
2022-01 入职: 用 2023年均
2022-07 入职: 用 2023年均
2023-01 入职: 用 2023年均
2023-07 入职: 用 2023年均
2024-01 入职: 用 首月工资
2024-07 入职: 用 首月工资
备注（给实现者）

“YYYY年均”取法需对 salary_month 做宽松识别（中文“YYYY年M月”等变体）后按自然年聚合求均。